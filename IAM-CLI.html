<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./style.css">
    <title>IAM + CLI</title>
    
</head>
<body>
<div class="container2">
    <div class="header">
        <h1>IAM + CLI</h1>
        <hr>
    </div>
    
    <h2>IAM (Identity and Access Management)</h2>
    <p>IAM is a web service that helps you securely control access to AWS resources. It allows you to manage users, groups, roles, and permissions.</p>
    <h3>Key Concepts:</h3>

    <ul>
    <li><strong>Users:</strong> Individual accounts for people or services that need access to AWS resources.</li>
    <ul>
        <li>Users do not have to belong to a group, however, that is not best practice.</li>
        <li>Users can belong to multiple groups.</li>
        <li>By Default, a root account is created. <strong>This account should not be used or shared!</strong></li>
    </ul>

    <li><strong>Groups:</strong> Collections of users that can be managed together. Groups only contain users, not other groups.</li>

    <li><strong>Roles:</strong> Sets of permissions that can be assumed by users or services.</li>
    <ul>
        <li>Permission sets that allow for temporary credentials - avoiding long-term access keys and thus improving security.</li>
        <li>Permissions that allow AWS Services to perform certain actions on the Users' behalf.</li>
        <li>Common Use Cases:</li>
        <ul>
            <li>EC2 Instance Roles</li>
            <li>Lambda Function Roles</li>
            <li>Roles for CloudFormation</li>
            <li>Cross-Account Access Roles</li>
        </ul>
        
    </ul>

    <li><strong>Policies:</strong> JSON Documents that define permissions and can be attached to users, groups, or roles.</li>
    <ul>
        <li><strong>Least Privilege Principle:</strong> giving a user, service, or system only the minimum permissions required to perform their tasks â€” and nothing more.</li>
        <li>AWS has thousands of pre-built policies that apply to most common use cases. You can also create custom JSON policies for unique cases.</li>
        <li>Policies attached to groups propagate down to the users. Best practice is to assign permissions at the group level (instead of user level).</li>
        <li>In-Line Policies: policies assigned directly to a user.</li>
    </ul>
</ul>

<div class="policy-flex">
    <div class="policy-text">
        <ul>
            <li><strong>Contents of a Policy:</strong></li>
            <ul>
                <li>Version: policy language version - always include "2012-10-17"</li>
                <li>Id: an identifier for the policy (optional)</li>
                <li>Statement: one or more individual statements (required)</li>
                <ul>
                    <li>Sid: an identifier of the statement (optional)</li>
                    <li>Effect: whether the statement allows or denies access (Allow, Deny)</li>
                    <li>Principal: account/user/role to which this policy applied to</li>
                    <li>Action: list of actions this policy allows or denies</li>
                    <li>Resource: list of resources which the actions applied to</li>
                    <li>Condition: conditions for when this policy is in effect (optional)</li>
                </ul>
            </ul>
        </ul>
    </div>

    <div class="policy-img">
        <img src="./images/iam-policy.png" alt="IAM Policy Structure">
    </div>

</div>
    <ul>
        <li><strong>Policy Evaluation Logic</strong></li>
        <ul>
            <li>Permission Boundaries</li>
            <ul>
                <li>Advanced feature to use a managed policy to set the max permissions an IAM entity can get</li>
                <li>supported for users and roles but <strong>not groups.</strong></li>
                <li>At a high level, boundaries set the outermost limit an IAM account can perform and then additional policies further refine what can be done.</li>
                <li>Can be used in combinations with SCPs</li>
                <ul>
                    <img src=".\images\EffectivePermissions-scp-boundary-id.png" style = "margin-top: 20px;margin-bottom: 20px;">
                </ul>
            </ul>
            <li><strong>Evaluation Flow Diagram</strong></li>
            <ul>
                <img src="./images/eval.png" style="max-width: 100%; margin-top: 20px; margin-bottom: 20px;">
            </ul>

        </ul>
        <li><strong>Password Policies:</strong> a policy that can be placed to increase the security of accounts.</li>
        <ul>
            <li>Can enforce minimum password lengths, specific character types, password expiration dates, and prevent password re-use</li>
            <li>Helpful against brute force attacks on aws accounts</li>
        </ul>
        <li><strong>MFA (Multi-Factor Authentication):</strong> An additional layer of security that requires users to provide two or more verification factors to gain access to AWS resources.</li>
        <ul>
            <li>MFA = password + security device you own</li>
            <li><strong>Device Options:</strong></li>
            <ul>
                <li>Virtual MFA Device - google authenticator (phone only), Authy (phone only)</li>
                <li>Universal 2nd Factor (U2F) Security Key - Yubikey by Yubico</li>
                <ul>
                    <li>This is a physical device that can support for multiple root and IAM users using a single key</li>
                </ul>
                <li>Hardware Key Fob MFA Device</li>
                <li>Hardware Key Fob MFA Device for AWS GovCloud</li>
    
            </ul>
        </ul>
        <li><strong>Security Tools: </strong>services designed to help protect your AWS environment by monitoring threats, enforcing security policies, identifying vulnerabilities, and ensuring compliance with industry standards.</li>
        <ul>
            <li><strong>IAM Credentials Report: </strong>report that lists account users and the status of their credentials. This is done at the account level.</li>
            <li><strong>IAM Advisor Access: </strong>show service permissions granted to a user and when those services were last accessed. Helps identify services not used and reinforce the principal of least privilege.</li>
        </ul>
        <li><strong>Organizations:</strong> A global service that allows for multi-account management.</li>
        <ul>
            <li>Features:</li>
            <ul>
                <li>Centralized Billing across multiple accounts with one single payment method</li>
                <ul>
                    <li>Volume pricing discounts are shared across all accounts in the organization</li>
                    <li>Shared reserved instances and savings plans discounts across accounts.</li>
                </ul>
                <li>The main account is the <strong>management account</strong> and the accounts created thereafter are the <strong>member accounts</strong></li>
                <ul>
                    <li>Management account has full control over member accounts</li>
                    <li>Member accounts can be invited or created, but can only exist in one organization</li>
                    <li>API is available to automate the account creation process</li>
                </ul>
                <li>Organizational Units (OUs) allow for grouping of accounts to apply policies</li>
                <ul>
                    <li>The main OU is the root, and there can be an unlimited amount of sub OU's</li>
                </ul>

            </ul>
            <li><strong>Advantages:</strong></li>
            <ul>
                <li>Having multiple accounts allows for better security - instead of using one account with multiple VPCs (accounts are more secure and separate than VPCs).</li>
                <li>Enforce Tagging Standards (for billing purposes)</li>
                <ul>
                    <li>Standardize tags across resources in a specific organization used to ensure consistent tagging and audit tagged resources.</li>
                    <li>Helps for Cost Allocation Tags and Attribute based Access Control.</li>
                    <li>Prevent any non-compliant tagging operations</li>
                    <li>Can generate a report that lists all tagged & untagged resources.</li>
                    <ul>
                        <li style = "font-style: italic;">Note: To monitor non-compliant tags use <strong>EventBridge</strong>.</li>
                    </ul>
                    <li><strong>Exam Tip: maintaining tag consistency across accounts -- TAG POLICIES!</strong></li>
                </ul>
                <li>Enable CloudTrail on all accounts & send logs to a central s3 account OR send cloudwatch logs to central logging account.</li>
                <li>Easily Establish Cross Account Roles for Admin purposes.</li>
                <li>Service Control Policies (SCPs)</li>
                <ul>
                    <li>Policies applied to OU or acccounts to restrict Users and Roles</li>
                    <li>They do not apply to the management account</li>
                    <li style = "font-style: italic;">Note: there must be an explicit allow from the root through each OU in the direct path to the target account. By default, nothing is allowed.</li>
                </ul>
            </ul>
        </ul>
    </ul>
    <hr class = "soft-divide">
    <h2>AWS CLI (Command Line Interface)</h2>
    <p>The CLI is another way users can access AWS through the Command Line, and it is protected by access keys.</p>
    <ul>
        <li><strong>Access Keys:</strong> long-term credentials used to authenticate programmatic requests to AWS services. They consist of an <strong>Access Key ID</strong> (similar to a username) and <strong>Secret Access Key</strong> (similar to a password).</li>
        <ul>
            <li>Outside of the CLI, Access Keys can be used in Software Development Kits, Direct API Calls, and applications or scripts that need to access AWS Resources.</li>
            <li><strong>Exam Callouts:</strong></li>
            <ul>
                <li>Access Keys grant the same permissions as the IAM user they belong to</li>
                <li>Keys should be protected and rotated regularly -- <strong>NEVER STORED IN CODE</strong></li>
                <li>Use IAM Roles instead of keys whenever possible</li>
                <li>Keys should never be created from the Root User</li>
                <li>Keys can be active, inactive, or deleted via IAM</li>
            </ul>
        </ul>
    </ul>
    <hr class = "soft-divide">
    <h2>AWS SDK (Software Development Kit)</h2>
    <p>The AWS SDK is a collection of tools and libraries that allow developers to interact with AWS services using various programming languages.</p>
    <ul>
        <li>Enables programmatic access to AWS Resources</li>
        <li>Embedded within your application (not through the command line)</li>
    </ul>
    <hr class = "soft-divide">
    <h2>AWS Cloudshell</h2>
    <p> AWS CloudShell is a browser-based, pre-authenticated shell environment that lets you run AWS CLI commands without installing anything on your local machine.
        It automatically uses your current IAM credentials and provides a secure, managed terminal directly inside the AWS Console. Cloudshell is a CLI alternative 
        - it is <strong>NOT</strong> available in all regions but it is <strong>FREE</strong> to use.</p>
    <ul>
        <li><strong>Features:</strong></li> 
        <ul>
            <li><strong>Fully managed</strong></li>
            <li><strong>Pre-authenticated</strong> with your current IAM user permissions</li>
            <ul>
                <li>No need to manually configure access keys or credentials</li>
            </ul>
            <li>Comes with a full repository - 1 GB of persistent storage per region (files exist after the shell is closed/terminated)</li>
            <li>Can be configured to user preference</li>
            <li>Can upload/download files into the cloudshell</li>
        </ul>
    </ul>
    <hr class = "soft-divide">
    <h2>IAM Identity Center  <span style="font-size: 0.7em; font-style: italic; font-weight: normal;">
    (successor to AWS Single Sign-On)
  </span></h2>
    <p>Service that provides a single sign on for all aws accounts, business cloud apps (e.g. Salesforce, M365, etc), SAML2.0-enabled applications, and EC2 Windows Instances.</p>
    <ul>
        <li>Identity Providers (where the users are stored) can be the built-in identity store in the IAM Identity Center or you can connect to a third-party provider</li>
        <li><strong>Permission Sets:</strong></li>
        <ul>
            <li>template that you create and maintain that defines a collection of one or more IAM policies.</li>
            <li>simplify the assignment of AWS account access for users and groups in your organization.</li>
        </ul>
        <li>Fine-grained Permissions and Assignments</li>
        <ul>
            <li>Multi-Account Permissions</li>
            <li>Application Assignments - SSO access, provides required URLs, certs, and metadata</li>
            <li><strong>Attribute Based Access Control (ABAC)</strong> - create permission sets using tags to control access</li>
            <ul>
                <li>Fine grained permissions based on users' attributes stored in the identity store.</li>
                <li>Example: allow access to resources only if the user's department tag matches the resource's department tag.</li>
            </ul>
        </ul>

    </ul>
     <hr class = "soft-divide">
    <h2>Advanced Concepts</h2>
    <ul>
        <li><strong>IAM Conditions</strong></li>
        <ul>
            <li><strong>aws:SourceIP</strong></li>
            <ul>
                <li>restricts the client IP from which the API calls are being made.</li>
            </ul>
            <li><strong>aws:RequestedRegion</strong></li>
            <ul>
                <li>restricts the region the API calls are made to.</li>
            </ul>
            <li><strong>aws:PrincipalTag/Department</strong></li>
            <ul>
                <li>restricts access based on tags associated with the IAM principal (user or role).</li>
            </ul>
            <li><Strong>aws:MultiFactorAuthPresent</Strong></li>
            <ul>
                <li>requires MFA to be used for access.</li>
            </ul>
            <li><strong>ec2:ResourceTag</strong></li>
            <ul>
                <li>restricts access to EC2 resources with specific tags.</li>
            </ul>
            <li><strong>NOTE: Object level permissions will have different tags than Bucket Level Permissions</strong></li>
            <ul>
                <li>Ex: Bucket Level arn -- arn:awss3:::test | Object Level arn -- arn:awss3:::test/* (* = access to every object)</li>
            </ul>
            <li><strong>aws:PrincipalOrgID</strong></li>
            <ul>
                <li>Restrict access to accounts that are members of an AWS Organization.</li>
                <img src = "./images/awsorgpolicyexample.png" alt="PrincipalOrgID Example" style = "max-width: 75%; border-radius: 10px; margin-top: 10px;">
            </ul>
        </ul>
        <li><strong>Roles vs Resource Based Policies</strong></li>
        <ul>
            <li>Accomplish the roughly the same thing but there is a difference</li>
            <ul>
                <li>Roles forfeit the original permissions and assume what is defined in the role.</li>
                <li>Resource Based Policies add to the existing permissions of the user.</li>
                <ul>
                    <li>Supported by resources such as S3, SNS Topics, SQS queues, and more.</li>
                </ul>
                <li>Example: User in account A needs to grab an object in an S3 bucket and dump it in an S3 bucket in Account B.</li>
            <li>This comes into play when using <strong>EventBridge -- </strong></li>
            <ul>
                <li>When a rule runs, it needs permissions on the target. If the target supports resource based policies, EventBridge will add a resource-based policy on the target. </li>
                <li>If the target does <strong>NOT</strong> support resource-based policies, EventBridge will use an IAM role to invoke the services of the target.</li>
            </ul>
            </ul>
        </ul>
        <li><strong>AWS Active Directory:</strong></li>
        <ul>
            <li>AWS Directory Service is a managed service that allows you to set up and run Microsoft Active Directory (AD) in the AWS Cloud or connect your AWS resources with an existing on-premises AD.</li>
            <li>Database of <strong>objects</strong> Users, Computers, Printers, File Shares, etc</li>
            <li>Objects are organized in <strong>trees</strong> and a group of trees is a <strong>forest</strong></li>
            <li>Three Flavors of services:</li>
            <ul>
                <li><strong>AWS Managed Microsoft AD</strong></li>
                <ul>
                    <li>create your own AD in AWS, manage users locally and supports MFA. Establish trust connections with your on-premise AD</li>
                </ul>
                <li><strong>AD Connector</strong></li>
                <ul>
                    <li>Proxy service that connects AWS services with your on-premise AD. No user management in AWS.</li>
                </ul>
                <li><strong>Simple AD</strong></li>
                <ul>
                    <li>Basic AD features with no trust relationships. Limited to 5000 objects. User management in AWS.</li>
                </ul>
            <li>IAM Identity Center - Active Directory Setup</li>
            <ul>
                <li>Connects IAM Identity Center to your Active Directory</li>
                <li>Allows users to sign in to the AWS SSO user portal with their AD credentials</li>
                <li>Connecting to a self-managed directory --> create a two trust relationship using AWS Managed Microsoft AD or Create an AD Connector</li>
            </ul>
        </ul>
    </ul>
    <li>AWS Control Tower</li>
    <ul>
        <li>Automated landing zone setup for multi-account AWS environments</li>
        <li>Implements best practices for security and compliance</li>
        <li>Includes pre-configured blueprints for account structure, network design, and security policies</li>
        <li>Integrates with AWS Organizations for centralized account management</li>
        <li>Monitor compliance through an interactive dashboard.</li>
        <li><strong>Guardrails:</strong></li>
        <ul>
            <li>A control (sometimes called a guardrail) is a high-level rule that provides ongoing governance for your overall AWS environment.</li>
            <li>Three types of guardrails:</li>
            <ul>
                <li><strong>Preventive:</strong> using SCPs to apply them to all accounts</li>
                <li><strong>Detective:</strong> uses AWS Config service (e.g identify untagged resources)</li>
                <li><strong>Proactive</strong></li>
            </ul>
            <li>Three categories of guidance apply to controls<span style = "font-style: italic;">(guardrails)</span>: strongly recommended, or elective.</li>
</div>

</body>
</html>